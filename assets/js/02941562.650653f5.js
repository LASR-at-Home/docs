"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[4514],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>g});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),u=s(t),m=i,g=u["".concat(l,".").concat(m)]||u[m]||c[m]||r;return t?a.createElement(g,o(o({ref:n},d),{},{components:t})):a.createElement(g,o({ref:n},d))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p[u]="string"==typeof e?e:i,o[1]=p;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5428:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>p,toc:()=>s});var a=t(7462),i=(t(7294),t(3905));const r={},o="Configuring Python dependencies for packages",p={unversionedId:"guides/virtualenv",id:"guides/virtualenv",title:"Configuring Python dependencies for packages",description:"There are two ways of managing Python dependencies for your packages, it is recommended that you use a virtual environment with a pinned Python version and pinned requirements, however if necessary this document also details how to add a dependency globally to the container.",source:"@site/docs/guides/virtualenv.md",sourceDirName:"guides",slug:"/guides/virtualenv",permalink:"/docs/guides/virtualenv",draft:!1,editUrl:"https://github.com/lasr-at-home/base/blob/main/common/document_lasr/web/docs/guides/virtualenv.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Container Maintenance",permalink:"/docs/guides/container"},next:{title:"coffee_shop",permalink:"/docs/tasks/coffee_shop"}},l={},s=[{value:"(A) Adding dependencies to container",id:"a-adding-dependencies-to-container",level:2},{value:"(B) Setting up a virtual environment using catkin_virtualenv",id:"b-setting-up-a-virtual-environment-using-catkin_virtualenv",level:2}],d={toc:s},u="wrapper";function c(e){let{components:n,...t}=e;return(0,i.kt)(u,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"configuring-python-dependencies-for-packages"},"Configuring Python dependencies for packages"),(0,i.kt)("p",null,"There are two ways of managing Python dependencies for your packages, it is recommended that you use a virtual environment with a pinned Python version and pinned requirements, however if necessary this document also details how to add a dependency globally to the container."),(0,i.kt)("h2",{id:"a-adding-dependencies-to-container"},"(A) Adding dependencies to container"),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Strongly advised against unless if you cannot migrate your code to a virtual environment right now.")),(0,i.kt)("p",null,"Find the line in the definition file where Python dependencies are declared:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"# Additional Python packages\n+ # pyyaml: yaml library\n- python3.8 -m pip install rosnumpy==0.0.5.2 scipy==1.5.4\n+ python3.8 -m pip install rosnumpy==0.0.5.2 scipy==1.5.4 pyyaml==6.0.1\n")),(0,i.kt)("p",null,"Then update the container maintenance document accordingly, you can do this by going to ",(0,i.kt)("a",{parentName:"p",href:"/guides/container"},"Container Maintenance")," and then clicking edit page at the bottom."),(0,i.kt)("h2",{id:"b-setting-up-a-virtual-environment-using-catkin_virtualenv"},"(B) Setting up a virtual environment using catkin_virtualenv"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Using catkin_virtualenv requires that catkin itself uses Python 3.8 or later during the build process, this is already managed for you by the container however may prove to be an issue if building a new container.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The following Python versions are available in the container:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"Python 2.7 (do not use)"),(0,i.kt)("li",{parentName:"ul"},"Python 3.8 (from TIAGo container)"),(0,i.kt)("li",{parentName:"ul"},"Python 3.9"),(0,i.kt)("li",{parentName:"ul"},"Python 3.10 (recommended)"))),(0,i.kt)("p",null,"Begin by configuring your package to use catkin_virtualenv, add the following entries to ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- package.xml --\x3e\n<package>\n  \x3c!-- metadata --\x3e\n\n  \x3c!-- .. your other dependencies --\x3e\n  <build_depend>catkin_virtualenv</build_depend>\n\n  <export>\n    \x3c!-- .. your other exports --\x3e\n    <pip_requirements>requirements.txt</pip_requirements>\n  </export>\n</package>\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"We add a dependency on the tool so the package won't ever build without it, we also add a new export to inform the wrapper script where to find the requirements file at runtime and to indicate that other packages with virtual environments should inherit dependencies from this package.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Given two packages with virtual environments, you can add a dependency to the ",(0,i.kt)("inlineCode",{parentName:"p"},"package.xml")," to inherit the other's dependencies."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- package.xml --\x3e\n<package>\n  \x3c!-- metadata --\x3e\n\n  \x3c!-- .. your other dependencies --\x3e\n  <depend>my_other_pkg_with_venv</depend>\n</package>\n"))),(0,i.kt)("p",null,"In your ",(0,i.kt)("inlineCode",{parentName:"p"},"CMakeLists.txt"),", add the package as a dependency:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cmake"},"find_package(catkin REQUIRED catkin_virtualenv .. your other dependencies)\n")),(0,i.kt)("p",null,"Then ensure Python setup is enabled and configure settings for the virtual environment:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cmake"},"catkin_python_setup()\ncatkin_generate_virtualenv(\n  INPUT_REQUIREMENTS requirements.in\n  PYTHON_INTERPRETER python3.10\n)\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Reasonable defaults are provided above, it is advised you always specify the interpreter and use locked dependencies (as opposed to just providing a requirements.txt file)."),(0,i.kt)("p",{parentName:"blockquote"},"You can read more about ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/locusrobotics/catkin_virtualenv/blob/master/README.md#additional-cmake-options"},"available options here"),".")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Ensure you have a ",(0,i.kt)("inlineCode",{parentName:"p"},"setup.py")," file configured, template provided below:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-python"},"#!/usr/bin/env python3\n\nfrom distutils.core import setup\nfrom catkin_pkg.python_setup import generate_distutils_setup\n\nsetup_args = generate_distutils_setup(\n  packages=['my_package'],\n  package_dir={'': 'src'}\n)\n\nsetup(**setup_args)\n"))),(0,i.kt)("p",null,"If you have any Python scripts, you must install them to be wrapped with the virtual environment:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cmake"},"catkin_install_python(PROGRAMS\n  nodes/my_service\n  scripts/do_something.py\n  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}\n)\n")),(0,i.kt)("p",null,"Make sure to also install the requirements file if you want other packages to inherit dependencies:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cmake"},"## Mark other files for installation (e.g. launch and bag files, etc.)\ninstall(FILES\n  requirements.txt\n  DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}\n)\n")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"This step is optional but recommended, you might as well add it.")),(0,i.kt)("p",null,"Finally, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.in")," file (or ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.txt")," if you did not set ",(0,i.kt)("inlineCode",{parentName:"p"},"INPUT_REQUIREMENTS"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-requirements"},"# requirements.in\nultralytics==8.0.150\nnumpy>1\nPyYaml\n")),(0,i.kt)("p",null,"You can generate the ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.txt")," file by running ",(0,i.kt)("inlineCode",{parentName:"p"},"catkin build my_package")," (or just a full build)."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If you want to update packages or install new packages, delete the ",(0,i.kt)("inlineCode",{parentName:"p"},"requirements.txt")," file and run build again.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"This also integrates with the ",(0,i.kt)("inlineCode",{parentName:"p"},"documentation")," package, you can regenerate your README to include / update your Python dependencies.")))}c.isMDXComponent=!0}}]);